import{m as z,_ as J,u as E,a as R,r as u,o as Y,b as q,d as r,e as l,f as t,t as o,j as k,l as G,n as m,i as _,k as C,F as h,g as P,w as $,p as I,h as K,B as Q}from"./index-bafae1ff.js";import{H as W}from"./heart-5e676e29.js";const X=z("ShareIcon",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),Z=z("VolumeIcon",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}]]);const ee={key:0,class:"max-w-4xl mx-auto"},te={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md"},ae={class:"mb-6 text-center"},ne={class:"text-3xl font-kai text-primary dark:text-dark-primary mb-2"},se={class:"text-gray-600 dark:text-gray-400"},oe={class:"flex flex-wrap justify-center gap-4 mb-6 p-3 bg-gray-50 dark:bg-gray-700 rounded-md"},re={class:"flex items-center space-x-2"},le={key:0,class:"text-sm text-gray-500 dark:text-gray-400 mb-1"},ie={class:"poem-line"},de={key:0,class:"relative group cursor-help border-b border-dashed border-gray-400"},ce={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-48 bg-white dark:bg-gray-700 p-2 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 text-sm"},ue={key:1},me={class:"flex justify-between items-center mb-8"},ge={class:"flex items-center space-x-4"},ve={class:"mt-10"},ye={class:"mb-6 bg-gray-50 dark:bg-gray-700 p-4 rounded-md"},pe={class:"mb-4"},be={class:"mb-4"},xe=["disabled"],ke={key:0},fe={class:"flex justify-between mb-2"},_e={class:"font-medium"},he={class:"text-sm text-gray-500 dark:text-gray-400"},we={class:"text-gray-700 dark:text-gray-300"},Se={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},Ce={key:1,class:"text-center py-10"},Pe={__name:"PoemDetail",setup($e){const D=E(),d=R(),s=u(null),y=u(!1),p=u(!1),g=u("medium"),b=u(!1),v=u(!1),x=u([]),i=u({nickname:localStorage.getItem("commentNickname")||"",content:""});Y(async()=>{d.poems.length===0&&await d.fetchPoems(),d.poets.length===0&&await d.fetchPoets();const a=D.params.id;s.value=d.getPoemById(a),s.value&&(b.value=d.isPoemLiked(a),v.value=d.isPoemFavorited(a),H(a))});const N=a=>{const e=d.poets.find(c=>c.name===a);return e?e.id:""},w=a=>{g.value=a},F=a=>a.split(""),V=(a,e)=>a.annotations&&a.annotations.some(c=>c.word.includes(e)),j=(a,e)=>{const c=a.annotations.find(n=>n.word.includes(e));return c?c.explanation:""},B=()=>{b.value||(d.likePoem(s.value.id),b.value=!0)},M=()=>{v.value?d.unfavoritePoem(s.value.id):d.favoritePoem(s.value.id),v.value=!v.value},L=()=>{const a=window.location.href;navigator.clipboard.writeText(a).then(()=>{alert("链接已复制到剪贴板，可以分享给好友了！")}).catch(e=>{console.error("无法复制链接: ",e)})},A=()=>{if("speechSynthesis"in window){const a=s.value.content.map(c=>c.sentence).join("，"),e=new SpeechSynthesisUtterance(a);e.lang="zh-CN",speechSynthesis.speak(e)}else alert("您的浏览器不支持语音合成功能")},H=a=>{const e=localStorage.getItem(`comments_${a}`);e&&(x.value=JSON.parse(e))},O=()=>{if(!i.value.nickname||!i.value.content)return;const a={nickname:i.value.nickname,content:i.value.content,timestamp:new Date().toISOString()};x.value.unshift(a),localStorage.setItem(`comments_${s.value.id}`,JSON.stringify(x.value)),localStorage.setItem("commentNickname",i.value.nickname),i.value.content=""},T=a=>{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`};return(a,e)=>{const c=q("router-link");return s.value?(r(),l("div",ee,[t("div",te,[t("div",ae,[t("h1",ne,o(s.value.title),1),t("p",se,[k(c,{to:`/poet/${N(s.value.author)}`,class:"hover:underline"},{default:G(()=>[C(o(s.value.dynasty)+" · "+o(s.value.author),1)]),_:1},8,["to"])])]),t("div",oe,[t("button",{onClick:e[0]||(e[0]=n=>y.value=!y.value),class:m(["btn",y.value?"btn-primary":"bg-gray-200 dark:bg-gray-600"])},o(y.value?"隐藏拼音":"显示拼音"),3),t("button",{onClick:e[1]||(e[1]=n=>p.value=!p.value),class:m(["btn",p.value?"btn-primary":"bg-gray-200 dark:bg-gray-600"])},o(p.value?"隐藏注释":"显示注释"),3),t("div",re,[t("button",{onClick:e[2]||(e[2]=n=>w("small")),class:m(["px-2 py-1 rounded",g.value==="small"?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600"])},"小",2),t("button",{onClick:e[3]||(e[3]=n=>w("medium")),class:m(["px-2 py-1 rounded",g.value==="medium"?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600"])},"中",2),t("button",{onClick:e[4]||(e[4]=n=>w("large")),class:m(["px-2 py-1 rounded",g.value==="large"?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600"])},"大",2)]),t("button",{onClick:A,class:"btn bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"},[k(_(Z),{size:"18",class:"mr-1"}),e[7]||(e[7]=C(" 朗读 ",-1))])]),t("div",{class:m(["mb-8 text-center",{"text-base":g.value==="small","text-xl":g.value==="medium","text-2xl":g.value==="large"}])},[(r(!0),l(h,null,P(s.value.content,(n,S)=>(r(),l("div",{key:S,class:"mb-4"},[y.value?(r(),l("div",le,o(n.pinyin),1)):K("",!0),t("div",ie,[(r(!0),l(h,null,P(F(n.sentence),(f,U)=>(r(),l(h,{key:U},[V(n,f)&&p.value?(r(),l("span",de,[C(o(f)+" ",1),t("span",ce,o(j(n,f)),1)])):(r(),l("span",ue,o(f),1))],64))),128))])]))),128))],2),t("div",me,[t("div",ge,[t("button",{onClick:B,class:m(["flex items-center space-x-1 focus:outline-none",{"text-red-500":b.value,"text-gray-400 hover:text-red-500":!b.value}])},[k(_(W),{size:"20"}),t("span",null,o(s.value.likes),1)],2),t("button",{onClick:M,class:m(["flex items-center space-x-1 focus:outline-none",{"text-yellow-500":v.value,"text-gray-400 hover:text-yellow-500":!v.value}])},[k(_(Q),{size:"20"}),t("span",null,o(v.value?"已收藏":"收藏"),1)],2)]),t("button",{onClick:L,class:"flex items-center space-x-1 text-gray-600 dark:text-gray-400 focus:outline-none"},[k(_(X),{size:"20"}),e[8]||(e[8]=t("span",null,"分享",-1))])]),t("div",ve,[e[11]||(e[11]=t("h3",{class:"text-xl font-kai text-primary dark:text-dark-primary mb-4"},"评论区",-1)),t("div",ye,[t("div",pe,[e[9]||(e[9]=t("label",{for:"nickname",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"昵称",-1)),$(t("input",{type:"text",id:"nickname","onUpdate:modelValue":e[5]||(e[5]=n=>i.value.nickname=n),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"请输入您的昵称"},null,512),[[I,i.value.nickname]])]),t("div",be,[e[10]||(e[10]=t("label",{for:"content",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"评论内容",-1)),$(t("textarea",{id:"content","onUpdate:modelValue":e[6]||(e[6]=n=>i.value.content=n),rows:"3",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"请输入您的评论"},null,512),[[I,i.value.content]])]),t("button",{onClick:O,class:"btn btn-primary",disabled:!i.value.nickname||!i.value.content}," 提交评论 ",8,xe)]),x.value.length>0?(r(),l("div",ke,[(r(!0),l(h,null,P(x.value,(n,S)=>(r(),l("div",{key:S,class:"border-b border-gray-200 dark:border-gray-700 py-4 last:border-0"},[t("div",fe,[t("span",_e,o(n.nickname),1),t("span",he,o(T(n.timestamp)),1)]),t("p",we,o(n.content),1)]))),128))])):(r(),l("div",Se," 暂无评论，快来发表第一条评论吧！ "))])])])):(r(),l("div",Ce,[...e[12]||(e[12]=[t("p",null,"加载中...",-1)])]))}}},De=J(Pe,[["__scopeId","data-v-2b8eb46c"]]);export{De as default};
